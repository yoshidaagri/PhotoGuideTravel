<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êú≠ÂπåË¶≥ÂÖâAI - ÂÆåÂÖ®ÁâàMVP</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèîÔ∏è</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2E7D32;
            --primary-dark: #1B5E20;
            --primary-light: #4CAF50;
            --secondary-color: #66BB6A;
            --secondary-dark: #43A047;
            --accent-color: #81C784;
            --success-color: #4CAF50;
            --bg-gradient: linear-gradient(135deg, #C8E6C9 0%, #A5D6A7 30%, #81C784 70%, #66BB6A 100%);
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(76, 175, 80, 0.2);
            --shadow: 0 20px 40px rgba(46, 125, 50, 0.15);
            --shadow-hover: 0 25px 50px rgba(46, 125, 50, 0.25);
            --nature-accent: #8BC34A;
            --forest-green: #388E3C;
            --leaf-green: #9CCC65;
        }

        body {
            font-family: 'BIZ UDPGothic', 'BIZ UDGothic', 'Hiragino Sans', 'Yu Gothic UI', 'Meiryo', 'MS PGothic', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: none;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
            color: #666;
        }

        .user-info.active {
            display: flex;
        }

        .logout-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: var(--secondary-dark);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        /* Main Container */
        .container {
            flex: 1;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
            width: 100%;
        }

        /* Login Section */
        .login-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
        }

        .login-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 3rem 2.5rem;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }

        .login-title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .login-subtitle {
            color: #666;
            margin-bottom: 2.5rem;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.2rem;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
            transform: translateY(-1px);
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }

        .login-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(46, 125, 50, 0.3);
            background: linear-gradient(45deg, var(--primary-dark), var(--secondary-dark));
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .demo-info {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e1e5e9;
            font-size: 0.85rem;
            color: #666;
            line-height: 1.6;
        }

        /* Main App Section */
        .main-app {
            display: none;
        }

        .main-app.active {
            display: block;
        }

        .welcome-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 2.5rem 2rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-border);
        }

        .welcome-title {
            font-size: 2.8rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--forest-green), var(--nature-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }

        .welcome-description {
            font-size: 1.1rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Analysis Type Selection */
        .analysis-type-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-border);
        }

        .analysis-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .analysis-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            max-width: 500px;
            margin: 0 auto;
        }

        .analysis-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-size: 0.95rem;
        }

        .analysis-option:hover {
            background: rgba(102, 187, 106, 0.1);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .analysis-option input[type="radio"] {
            display: none;
        }

        .analysis-option input[type="radio"]:checked + .analysis-icon + .analysis-name,
        .analysis-option:has(input[type="radio"]:checked) {
            background: var(--secondary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(102, 187, 106, 0.3);
        }

        .analysis-icon {
            font-size: 2rem;
        }

        .analysis-name {
            font-weight: 500;
        }

        .store-option:has(input[type="radio"]:checked) {
            background: linear-gradient(135deg, #e8f5e8, #f0f8ff);
            border-color: var(--primary-color);
        }

        .menu-option:has(input[type="radio"]:checked) {
            background: linear-gradient(135deg, #fff8dc, #fdf5e6);
            border-color: #ff9800;
        }

        /* Language Selection */
        .language-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-border);
        }

        .language-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .language-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .language-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-size: 0.95rem;
        }

        .language-option:hover {
            background: rgba(102, 187, 106, 0.1);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .language-option input[type="radio"] {
            display: none;
        }

        .language-option input[type="radio"]:checked + .language-flag + .language-name,
        .language-option:has(input[type="radio"]:checked) {
            background: var(--secondary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(102, 187, 106, 0.3);
        }

        .language-flag {
            font-size: 1.2rem;
        }

        .language-name {
            font-weight: 500;
        }

        /* Upload Section */
        .upload-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
            border: 2px dashed #e1e5e9;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .upload-section:hover {
            border-color: var(--secondary-color);
            background: rgba(102, 187, 106, 0.08);
            transform: translateY(-2px);
        }

        .upload-section.dragover {
            border-color: var(--primary-color);
            background: rgba(76, 175, 80, 0.12);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }

        .upload-text {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .upload-subtext {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.5;
            max-width: 500px;
            margin: 0 auto;
        }

        .file-input {
            display: none;
        }

        /* Preview Section */
        .preview-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-border);
        }

        .preview-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .preview-image {
            max-width: 100%;
            max-height: 450px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            margin-bottom: 1.5rem;
        }

        .image-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(33, 150, 243, 0.05);
            border-radius: 12px;
            font-size: 0.9rem;
        }

        .image-detail {
            color: #666;
        }

        .image-detail strong {
            color: #333;
        }

        .analyze-btn {
            background: linear-gradient(45deg, var(--secondary-color), var(--accent-color));
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 8px 20px rgba(102, 187, 106, 0.3);
        }

        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(76, 175, 80, 0.4);
            background: linear-gradient(45deg, var(--secondary-dark), var(--primary-light));
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Loading Section */
        .loading-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 3rem;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-border);
        }

        .loading-spinner {
            font-size: 4rem;
            animation: spin 2s linear infinite;
            margin-bottom: 1.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .loading-subtext {
            color: #666;
            font-size: 1rem;
            line-height: 1.5;
        }

        /* Results Section */
        .results-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-border);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .results-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .new-analysis-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .new-analysis-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        .results-content {
            line-height: 1.8;
            color: #333;
            white-space: pre-wrap;
            font-size: 1rem;
            background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.1));
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header-content {
                padding: 0 1rem;
            }

            .logo {
                font-size: 1.3rem;
            }

            .login-card {
                padding: 2rem 1.5rem;
                margin: 0 1rem;
            }

            .login-title {
                font-size: 2rem;
            }

            .welcome-title {
                font-size: 2.2rem;
            }

            .welcome-section,
            .upload-section,
            .preview-section,
            .loading-section,
            .results-section {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }

            .results-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .image-details {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .upload-icon {
                font-size: 3rem;
            }

            .upload-text {
                font-size: 1.1rem;
            }

            .loading-spinner {
                font-size: 3rem;
            }

            .user-info {
                font-size: 0.8rem;
            }

            .user-info span:first-child {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .user-section {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    üèîÔ∏è Êú≠ÂπåË¶≥ÂÖâAI
                </div>
                <div class="user-section">
                    <div id="userInfo" class="user-info">
                        <span>üë§ <span id="currentUser">sapporo-guide</span></span>
                        <button onclick="logout()" class="logout-btn" data-i18n="logout">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Login Section -->
            <div id="loginSection" class="login-section">
                <div class="login-card fade-in">
                    <h1 class="login-title">üèîÔ∏è</h1>
                    <h2 class="login-subtitle" data-i18n="loginTitle">Êú≠ÂπåË¶≥ÂÖâAI - ÁîªÂÉèËß£Êûê„Ç¨„Ç§„Éâ</h2>
                    
                    <form id="loginForm">
                        <div class="form-group">
                            <label class="form-label" data-i18n="loginUsername">„É¶„Éº„Ç∂„ÉºID</label>
                            <input type="text" id="username" class="form-input" data-i18n="currentUser" placeholder="sapporo-guide" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" data-i18n="loginPassword">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                            <input type="password" id="password" class="form-input" placeholder="hokkaido2024" required>
                        </div>
                        
                        <button type="submit" id="loginBtn" class="login-btn" data-i18n="loginButton">
                            üîê „É≠„Ç∞„Ç§„É≥
                        </button>
                    </form>
                    
                    <div class="demo-info">
                        <p><strong>üì± „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥„ÉªPCÂØæÂøú</strong></p>
                        <p><strong>„Éá„É¢„Ç¢„Ç´„Ç¶„É≥„Éà:</strong></p>
                        <p>ID: <strong>sapporo-guide</strong></p>
                        <p>PASS: <strong>hokkaido2024</strong></p>
                        <p><small>Êú≠Âπå„ÅÆÂ∫óËàó„ÉªË¶≥ÂÖâÂú∞„ÉªÊñôÁêÜÁîªÂÉè„ÇíAI„ÅåË©≥„Åó„ÅèËß£Êûê„Åó„Åæ„Åô</small></p>
                    </div>
                </div>
            </div>

            <!-- Main Application -->
            <div id="mainApp" class="main-app">
                <!-- Welcome Section -->
                <section class="welcome-section fade-in">
                    <h1 class="welcome-title" data-i18n="title">Êú≠ÂπåË¶≥ÂÖâAIÁîªÂÉèËß£Êûê</h1>
                    <p class="welcome-description">
                        <span data-i18n="description">Êú≠Âπå„ÅÆÂ∫óËàó„ÉªË¶≥ÂÖâÂú∞„ÉªÊñôÁêÜ„ÅÆÁîªÂÉè„ÇíAI„ÅåË©≥„Åó„ÅèËß£Êûê„Åó„ÄÅÂú∞ÂÖÉÊÉÖÂ†±„ÇÑ„Åä„Åô„Åô„ÇÅ„Çπ„Éù„ÉÉ„Éà„Çí„ÅîÁ¥π‰ªã„Åó„Åæ„Åô</span>
                    </p>
                </section>

                <!-- Language Selection -->
                <section class="language-section">
                    <h3 class="language-title" data-i18n="languageSelect">üåê Ëß£ÊûêË®ÄË™û„ÇíÈÅ∏Êäû</h3>
                    <div class="language-options">
                        <label class="language-option">
                            <input type="radio" name="language" value="ja" checked>
                            <span class="language-flag">üáØüáµ</span>
                            <span class="language-name">Êó•Êú¨Ë™û</span>
                        </label>
                        <label class="language-option">
                            <input type="radio" name="language" value="ko">
                            <span class="language-flag">üá∞üá∑</span>
                            <span class="language-name">ÌïúÍµ≠Ïñ¥</span>
                        </label>
                        <label class="language-option">
                            <input type="radio" name="language" value="zh">
                            <span class="language-flag">üá®üá≥</span>
                            <span class="language-name">ÁÆÄ‰Ωì‰∏≠Êñá</span>
                        </label>
                        <label class="language-option">
                            <input type="radio" name="language" value="en">
                            <span class="language-flag">üá∫üá∏</span>
                            <span class="language-name">English</span>
                        </label>
                    </div>
                </section>

                <!-- Analysis Type Selection -->
                <section class="analysis-type-section">
                    <h3 class="analysis-title" data-i18n="analysisTypeSelect">üîç Ëß£Êûê„Çø„Ç§„Éó„ÇíÈÅ∏Êäû</h3>
                    <div class="analysis-options">
                        <label class="analysis-option store-option">
                            <input type="radio" name="analysisType" value="store" checked>
                            <span class="analysis-icon">üè™üïå</span>
                            <span class="analysis-name" data-i18n="storeAnalysis">Â∫óËàó„ÉªË¶≥ÂÖâÂú∞ÂàÜÊûê</span>
                        </label>
                        <label class="analysis-option menu-option">
                            <input type="radio" name="analysisType" value="menu">
                            <span class="analysis-icon">üìãüçú</span>
                            <span class="analysis-name" data-i18n="menuTranslation">ÁúãÊùø„Éª„É°„Éã„É•„ÉºÁøªË®≥</span>
                        </label>
                    </div>
                </section>

                <!-- Upload Section -->
                <section id="uploadSection" class="upload-section" onclick="document.getElementById('imageInput').click()">
                    <div class="upload-icon">üì∏</div>
                    <div class="upload-text" data-i18n="uploadText">ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</div>
                    <div class="upload-subtext">
                        <span data-i18n="uploadSubtext">Êú≠Âπå„ÅÆÂ∫óËàó„ÉªË¶≥ÂÖâÂú∞„ÉªÊñôÁêÜ„ÅÆÂÜôÁúü„Çí„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó</span><br>
                        <strong><span data-i18n="fileFormat">ÂØæÂøúÂΩ¢Âºè: JPG, PNG, GIF (ÊúÄÂ§ß 10MB)</span></strong><br>
                        <strong><span id="recommendedText" data-i18n="storeRecommended">Êé®Â•®: „É©„Éº„É°„É≥„ÄÅ„Ç∏„É≥„ÇÆ„Çπ„Ç´„É≥„ÄÅÈõ™„Åæ„Å§„Çä„ÄÅ„Åô„Åô„Åç„ÅÆÁ≠â</span></strong>
                    </div>
                    <input type="file" id="imageInput" class="file-input" accept="image/*">
                </section>

                <!-- Preview Section -->
                <section id="previewSection" class="preview-section hidden">
                    <h3 class="preview-title" data-i18n="previewTitle">üìã „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÁîªÂÉè„Éó„É¨„Éì„É•„Éº</h3>
                    <img id="previewImage" class="preview-image" alt="„Éó„É¨„Éì„É•„Éº">
                    <div id="imageDetails" class="image-details"></div>
                    <button onclick="analyzeImage()" id="analyzeBtn" class="analyze-btn">
                        <span id="analyzeBtnText" data-i18n="analyzeButton">ü§ñ Êú≠ÂπåË¶≥ÂÖâAIËß£Êûê„ÇíÈñãÂßã</span>
                    </button>
                </section>

                <!-- Loading Section -->
                <section id="loadingSection" class="loading-section hidden">
                    <div class="loading-spinner">ü§ñ</div>
                    <div class="loading-text" data-i18n="loading">Êú≠ÂπåË¶≥ÂÖâAI„ÅåËß£Êûê‰∏≠...</div>
                    <div class="loading-subtext">
                        <span data-i18n="loadingSubtext">„Åô„Åô„Åç„ÅÆ„ÉªÂ§ßÈÄö„ÉªÊú≠Âπå„Ç∞„É´„É°„ÉªË¶≥ÂÖâ„Çπ„Éù„ÉÉ„Éà</span><br>
                        <span data-i18n="loadingDetail">Ë©≥Á¥∞„Å™Âú∞ÂÖÉÊÉÖÂ†±„ÇíÂàÜÊûê„Åó„Å¶„ÅÑ„Åæ„Åô</span>
                    </div>
                </section>

                <!-- Results Section -->
                <section id="resultsSection" class="results-section hidden">
                    <div class="results-header">
                        <h3 class="results-title">üèîÔ∏è Êú≠ÂπåË¶≥ÂÖâAIËß£ÊûêÁµêÊûú</h3>
                        <button onclick="newAnalysis()" class="new-analysis-btn">üîÑ Êñ∞„Åó„ÅÑËß£Êûê</button>
                    </div>
                    <div id="resultsContent" class="results-content"></div>
                </section>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'https://f4n095fm2j.execute-api.ap-northeast-1.amazonaws.com/dev';
        const CREDENTIALS = {
            username: 'sapporo-guide',
            password: 'hokkaido2024'
        };

        // State
        let selectedImage = null;
        let isLoggedIn = false;

        // Translation dictionary for UI internationalization
        const translations = {
            ja: {
                title: "Êú≠ÂπåË¶≥ÂÖâAIÁîªÂÉèËß£Êûê",
                description: "Êú≠Âπå„ÅÆÂ∫óËàó„ÉªË¶≥ÂÖâÂú∞„ÉªÊñôÁêÜ„ÅÆÁîªÂÉè„ÇíAI„ÅåË©≥„Åó„ÅèËß£Êûê„Åó„ÄÅÂú∞ÂÖÉÊÉÖÂ†±„ÇÑ„Åä„Åô„Åô„ÇÅ„Çπ„Éù„ÉÉ„Éà„Çí„ÅîÁ¥π‰ªã„Åó„Åæ„Åô",
                languageSelect: "Ëß£ÊûêË®ÄË™û„ÇíÈÅ∏Êäû",
                analysisTypeSelect: "Ëß£Êûê„Çø„Ç§„Éó„ÇíÈÅ∏Êäû",
                storeAnalysis: "Â∫óËàó„ÉªË¶≥ÂÖâÂú∞ÂàÜÊûê",
                menuTranslation: "ÁúãÊùø„Éª„É°„Éã„É•„ÉºÁøªË®≥",
                uploadText: "ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ",
                uploadSubtext: "Êú≠Âπå„ÅÆÂ∫óËàó„ÉªË¶≥ÂÖâÂú∞„ÉªÊñôÁêÜ„ÅÆÂÜôÁúü„Çí„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó",
                fileFormat: "ÂØæÂøúÂΩ¢Âºè: JPG, PNG, GIF (ÊúÄÂ§ß 10MB)",
                storeRecommended: "Êé®Â•®: „É©„Éº„É°„É≥„ÄÅ„Ç∏„É≥„ÇÆ„Çπ„Ç´„É≥„ÄÅÈõ™„Åæ„Å§„Çä„ÄÅ„Åô„Åô„Åç„ÅÆÁ≠â",
                menuRecommended: "Áâπ„Å´ÊúâÂäπ: ÊâãÊõ∏„Åç„É°„Éã„É•„Éº„ÄÅ‰æ°Ê†ºË°®„ÄÅÊ≥®ÊñáË°®Á≠â",
                previewTitle: "„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÁîªÂÉè„Éó„É¨„Éì„É•„Éº",
                analyzeButton: "Êú≠ÂπåË¶≥ÂÖâAIËß£Êûê„ÇíÈñãÂßã",
                loading: "Êú≠ÂπåË¶≥ÂÖâAI„ÅåËß£Êûê‰∏≠...",
                loadingSubtext: "„Åô„Åô„Åç„ÅÆ„ÉªÂ§ßÈÄö„ÉªÊú≠Âπå„Ç∞„É´„É°„ÉªË¶≥ÂÖâ„Çπ„Éù„ÉÉ„Éà",
                loadingDetail: "Ë©≥Á¥∞„Å™Âú∞ÂÖÉÊÉÖÂ†±„ÇíÂàÜÊûê„Åó„Å¶„ÅÑ„Åæ„Åô",
                loginTitle: "Êú≠ÂπåË¶≥ÂÖâAI - ÁîªÂÉèËß£Êûê„Ç¨„Ç§„Éâ",
                loginUsername: "„É¶„Éº„Ç∂„ÉºID",
                loginPassword: "„Éë„Çπ„ÉØ„Éº„Éâ",
                loginButton: "„É≠„Ç∞„Ç§„É≥",
                loginProcessing: "Ë™çË®º‰∏≠...",
                currentUser: "sapporo-guide",
                logout: "„É≠„Ç∞„Ç¢„Ç¶„Éà"
            },
            ko: {
                title: "ÏÇøÌè¨Î°ú Í¥ÄÍ¥ë AI ÌôîÏÉÅ Î∂ÑÏÑù",
                description: "ÏÇøÌè¨Î°úÏùò ÏÉÅÏ†ê„ÉªÍ¥ÄÍ¥ëÏßÄ„ÉªÏöîÎ¶¨ Ïù¥ÎØ∏ÏßÄÎ•º AIÍ∞Ä ÏÉÅÏÑ∏Ìûà Î∂ÑÏÑùÌïòÏó¨ ÏßÄÏó≠ Ï†ïÎ≥¥ÏôÄ Ï∂îÏ≤ú Ïä§ÌåüÏùÑ ÏÜåÍ∞úÌï©ÎãàÎã§",
                languageSelect: "Î∂ÑÏÑù Ïñ∏Ïñ¥ ÏÑ†ÌÉù",
                analysisTypeSelect: "Î∂ÑÏÑù Ïú†Ìòï ÏÑ†ÌÉù", 
                storeAnalysis: "ÏÉÅÏ†ê„ÉªÍ¥ÄÍ¥ëÏßÄ Î∂ÑÏÑù",
                menuTranslation: "Í∞ÑÌåê„ÉªÎ©îÎâ¥ Î≤àÏó≠",
                uploadText: "Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú",
                uploadSubtext: "ÏÇøÌè¨Î°ú ÏÉÅÏ†ê„ÉªÍ¥ÄÍ¥ëÏßÄ„ÉªÏöîÎ¶¨ ÏÇ¨ÏßÑÏùÑ ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ & ÎìúÎ°≠",
                fileFormat: "ÎåÄÏùë ÌòïÏãù: JPG, PNG, GIF (ÏµúÎåÄ 10MB)",
                storeRecommended: "Ï∂îÏ≤ú: ÎùºÎ©ò, ÏßïÍ∏∞Ïä§Ïπ∏, ÎààÏ∂ïÏ†ú, Ïä§Ïä§ÌÇ§ÎÖ∏ Îì±",
                menuRecommended: "ÌäπÌûà Ìö®Í≥ºÏ†Å: ÏÜêÍ∏ÄÏî® Î©îÎâ¥, Í∞ÄÍ≤©Ìëú, Ï£ºÎ¨∏Ìëú Îì±",
                previewTitle: "ÏóÖÎ°úÎìú Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞",
                analyzeButton: "ÏÇøÌè¨Î°ú Í¥ÄÍ¥ë AI Î∂ÑÏÑù ÏãúÏûë",
                loading: "ÏÇøÌè¨Î°ú Í¥ÄÍ¥ë AIÍ∞Ä Î∂ÑÏÑùÏ§ë...",
                loadingSubtext: "Ïä§Ïä§ÌÇ§ÎÖ∏„ÉªÏò§ÎèÑÎ¶¨„ÉªÏÇøÌè¨Î°ú Í∑∏Î£®Î©î„ÉªÍ¥ÄÍ¥ë Ïä§Ìåü",
                loadingDetail: "ÏÉÅÏÑ∏Ìïú ÏßÄÏó≠ Ï†ïÎ≥¥Î•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§",
                loginTitle: "ÏÇøÌè¨Î°ú Í¥ÄÍ¥ë AI - ÌôîÏÉÅ Î∂ÑÏÑù Í∞ÄÏù¥Îìú",
                loginUsername: "ÏÇ¨Ïö©Ïûê ID",
                loginPassword: "ÎπÑÎ∞ÄÎ≤àÌò∏",
                loginButton: "Î°úÍ∑∏Ïù∏",
                loginProcessing: "Ïù∏Ï¶ùÏ§ë...",
                currentUser: "sapporo-guide",
                logout: "Î°úÍ∑∏ÏïÑÏõÉ"
            },
            zh: {
                title: "Êú≠ÂπåËßÇÂÖâAIÂõæÂÉèÂàÜÊûê",
                description: "AIËØ¶ÁªÜÂàÜÊûêÊú≠ÂπåÂ∫óÈì∫„ÉªËßÇÂÖâÂú∞„ÉªÊñôÁêÜÂõæÂÉèÔºå‰ªãÁªçÂΩìÂú∞‰ø°ÊÅØÂíåÊé®ËçêÊôØÁÇπ",
                languageSelect: "ÈÄâÊã©ÂàÜÊûêËØ≠Ë®Ä",
                analysisTypeSelect: "ÈÄâÊã©ÂàÜÊûêÁ±ªÂûã",
                storeAnalysis: "Â∫óÈì∫„ÉªËßÇÂÖâÂú∞ÂàÜÊûê",
                menuTranslation: "ÊãõÁâå„ÉªËèúÂçïÁøªËØë",
                uploadText: "‰∏ä‰º†ÂõæÂÉè",
                uploadSubtext: "ÁÇπÂáªÊàñÊãñÊãΩ‰∏ä‰º†Êú≠ÂπåÂ∫óÈì∫„ÉªËßÇÂÖâÂú∞„ÉªÊñôÁêÜÁÖßÁâá",
                fileFormat: "ÊîØÊåÅÊ†ºÂºè: JPG, PNG, GIF (ÊúÄÂ§ß 10MB)",
                storeRecommended: "Êé®Ëçê: ÊãâÈù¢„ÄÅÊàêÂêâÊÄùÊ±óÁÉ§ËÇâ„ÄÅÈõ™Á•≠„ÄÅËñÑÈáéÁ≠â",
                menuRecommended: "ÁâπÂà´ÊúâÊïà: ÊâãÂÜôËèúÂçï„ÄÅ‰ª∑Ê†ºË°®„ÄÅËÆ¢ÂçïÁ≠â",
                previewTitle: "‰∏ä‰º†ÂõæÂÉèÈ¢ÑËßà",
                analyzeButton: "ÂºÄÂßãÊú≠ÂπåËßÇÂÖâAIÂàÜÊûê",
                loading: "Êú≠ÂπåËßÇÂÖâAIÂàÜÊûê‰∏≠...",
                loadingSubtext: "ËñÑÈáé„ÉªÂ§ßÈÄö„ÉªÊú≠ÂπåÁæéÈ£ü„ÉªËßÇÂÖâÊôØÁÇπ",
                loadingDetail: "Ê≠£Âú®ÂàÜÊûêËØ¶ÁªÜÁöÑÂΩìÂú∞‰ø°ÊÅØ",
                loginTitle: "Êú≠ÂπåËßÇÂÖâAI - ÂõæÂÉèÂàÜÊûêÂêëÂØº",
                loginUsername: "Áî®Êà∑ID",
                loginPassword: "ÂØÜÁ†Å",
                loginButton: "ÁôªÂΩï",
                loginProcessing: "ËÆ§ËØÅ‰∏≠...",
                currentUser: "sapporo-guide",
                logout: "ÈÄÄÂá∫ÁôªÂΩï"
            },
            en: {
                title: "Sapporo Tourism AI Image Analysis",
                description: "AI analyzes images of Sapporo stores, tourist spots, and cuisine in detail, introducing local information and recommended spots",
                languageSelect: "Select Analysis Language",
                analysisTypeSelect: "Select Analysis Type",
                storeAnalysis: "Store„ÉªTourism Analysis",
                menuTranslation: "Signboard„ÉªMenu Translation", 
                uploadText: "Upload Image",
                uploadSubtext: "Click or drag & drop photos of Sapporo stores, tourist spots, and cuisine",
                fileFormat: "Supported formats: JPG, PNG, GIF (max 10MB)",
                storeRecommended: "Recommended: Ramen, Jingisukan, Snow Festival, Susukino, etc.",
                menuRecommended: "Especially effective: Handwritten menus, price lists, order forms, etc.",
                previewTitle: "Upload Image Preview",
                analyzeButton: "Start Sapporo Tourism AI Analysis",
                loading: "Sapporo Tourism AI Analyzing...",
                loadingSubtext: "Susukino„ÉªOdori„ÉªSapporo Gourmet„ÉªTourist Spots",
                loadingDetail: "Analyzing detailed local information",
                loginTitle: "Sapporo Tourism AI - Image Analysis Guide",
                loginUsername: "User ID", 
                loginPassword: "Password",
                loginButton: "Login",
                loginProcessing: "Authenticating...",
                currentUser: "sapporo-guide",
                logout: "Logout"
            }
        };

        // DOM Elements
        const loginSection = document.getElementById('loginSection');
        const mainApp = document.getElementById('mainApp');
        const userInfo = document.getElementById('userInfo');
        const uploadSection = document.getElementById('uploadSection');
        const previewSection = document.getElementById('previewSection');
        const loadingSection = document.getElementById('loadingSection');
        const resultsSection = document.getElementById('resultsSection');

        // Initialize
        document.addEventListener('DOMContentLoaded', init);

        function init() {
            setupEventListeners();
            checkAuthStatus();
            initializeLanguage();
        }

        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);

            // File input
            document.getElementById('imageInput').addEventListener('change', handleFileSelect);

            // Drag and drop
            uploadSection.addEventListener('dragover', handleDragOver);
            uploadSection.addEventListener('drop', handleDrop);
            uploadSection.addEventListener('dragleave', handleDragLeave);

            // Language change listeners
            document.querySelectorAll('input[name="language"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    updateUILanguage(e.target.value);
                });
            });

            // Analysis type change listeners
            document.querySelectorAll('input[name="analysisType"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    updateRecommendedText(e.target.value);
                });
            });
        }

        // UI Language Update Functions
        function updateUILanguage(language) {
            const t = translations[language];
            if (!t) return;

            // Update all elements with data-i18n attributes
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (t[key]) {
                    // Handle different element types
                    if (element.tagName === 'INPUT' && element.type === 'text') {
                        element.placeholder = t[key];
                    } else if (element.tagName === 'INPUT' && element.type === 'password') {
                        element.placeholder = t[key];
                    } else {
                        // Preserve emojis and icons at the beginning of text
                        const currentText = element.textContent;
                        const emojiMatch = currentText.match(/^[\u{1F000}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]+\s*/u);
                        const emoji = emojiMatch ? emojiMatch[0] : '';
                        element.textContent = emoji + t[key];
                    }
                }
            });

            // Update document language attribute
            document.documentElement.lang = language;

            // Update font family based on language
            updateFontFamily(language);

            // Store selected language in sessionStorage
            sessionStorage.setItem('selectedLanguage', language);

            // Update recommended text based on current analysis type
            const currentAnalysisType = document.querySelector('input[name="analysisType"]:checked')?.value || 'store';
            updateRecommendedText(currentAnalysisType);
        }

        function updateRecommendedText(analysisType) {
            const currentLanguage = sessionStorage.getItem('selectedLanguage') || 'ja';
            const t = translations[currentLanguage];
            const recommendedElement = document.getElementById('recommendedText');
            
            if (recommendedElement && t) {
                if (analysisType === 'menu') {
                    recommendedElement.textContent = t.menuRecommended;
                    recommendedElement.setAttribute('data-i18n', 'menuRecommended');
                } else {
                    recommendedElement.textContent = t.storeRecommended;
                    recommendedElement.setAttribute('data-i18n', 'storeRecommended');
                }
            }
        }

        function updateFontFamily(language) {
            const body = document.body;
            switch (language) {
                case 'ko':
                    body.style.fontFamily = "'Noto Sans KR', 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif";
                    break;
                case 'zh':
                    body.style.fontFamily = "'Noto Sans SC', 'Microsoft YaHei', 'PingFang SC', sans-serif";
                    break;
                case 'en':
                    body.style.fontFamily = "'Inter', 'Roboto', 'Segoe UI', sans-serif";
                    break;
                default: // ja
                    body.style.fontFamily = "'BIZ UDPGothic', 'BIZ UDGothic', 'Hiragino Sans', 'Yu Gothic UI', sans-serif";
            }
        }

        function initializeLanguage() {
            // Load saved language or default to Japanese
            const savedLanguage = sessionStorage.getItem('selectedLanguage') || 'ja';
            const languageRadio = document.querySelector(`input[name="language"][value="${savedLanguage}"]`);
            if (languageRadio) {
                languageRadio.checked = true;
                updateUILanguage(savedLanguage);
            }
        }

        // Authentication
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');

            const currentLanguage = sessionStorage.getItem('selectedLanguage') || 'ja';
            const t = translations[currentLanguage];

            loginBtn.disabled = true;
            loginBtn.textContent = t.loginProcessing;

            setTimeout(() => {
                if (username === CREDENTIALS.username && password === CREDENTIALS.password) {
                    isLoggedIn = true;
                    sessionStorage.setItem('sapporoAuth', 'true');
                    sessionStorage.setItem('sapporoUser', username);
                    showMainApp();
                } else {
                    const errorMessages = {
                        ja: '‚ùå „É≠„Ç∞„Ç§„É≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü\n\nÊ≠£„Åó„ÅÑID„Éª„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ\n\nID: sapporo-guide\nPASS: hokkaido2024',
                        ko: '‚ùå Î°úÍ∑∏Ïù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§\n\nÏò¨Î∞îÎ•∏ ID„ÉªÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî\n\nID: sapporo-guide\nPASS: hokkaido2024',
                        zh: '‚ùå ÁôªÂΩïÂ§±Ë¥•\n\nËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑID„ÉªÂØÜÁ†Å\n\nID: sapporo-guide\nPASS: hokkaido2024',
                        en: '‚ùå Login failed\n\nPlease enter correct ID and password\n\nID: sapporo-guide\nPASS: hokkaido2024'
                    };
                    alert(errorMessages[currentLanguage]);
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'üîê ' + t.loginButton;
                }
            }, 800);
        }

        function checkAuthStatus() {
            const authStatus = sessionStorage.getItem('sapporoAuth');
            const username = sessionStorage.getItem('sapporoUser');
            
            if (authStatus === 'true' && username) {
                isLoggedIn = true;
                document.getElementById('currentUser').textContent = username;
                showMainApp();
            }
        }

        function showMainApp() {
            loginSection.classList.add('hidden');
            mainApp.classList.add('active');
            userInfo.classList.add('active');
        }

        function logout() {
            isLoggedIn = false;
            sessionStorage.removeItem('sapporoAuth');
            sessionStorage.removeItem('sapporoUser');
            
            resetApp();
            
            mainApp.classList.remove('active');
            userInfo.classList.remove('active');
            loginSection.classList.remove('hidden');
            
            document.getElementById('loginForm').reset();
        }

        // File Handling
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) processFile(file);
        }

        function handleDragOver(e) {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) processFile(files[0]);
        }

        function processFile(file) {
            // Validate file
            if (!file.type.startsWith('image/')) {
                alert('‚ùå ÁîªÂÉè„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ\n\nÂØæÂøúÂΩ¢Âºè: JPG, PNG, GIF');
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                alert('‚ùå „Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„ÅØ10MB‰ª•‰∏ã„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ\n\nÁèæÂú®„ÅÆ„Çµ„Ç§„Ç∫: ' + (file.size / (1024 * 1024)).toFixed(1) + 'MB');
                return;
            }

            // Resize image if needed
            resizeImage(file, 1200).then(resizedFile => {
                selectedImage = resizedFile;
                showPreview(resizedFile);
            }).catch(error => {
                console.error('Image resize error:', error);
                selectedImage = file;
                showPreview(file);
            });
        }

        function resizeImage(file, maxSize = 1200) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    // Calculate new dimensions
                    let { width, height } = img;
                    
                    if (width <= maxSize && height <= maxSize) {
                        // No resize needed
                        resolve(file);
                        return;
                    }
                    
                    // Calculate resize ratio
                    const ratio = Math.min(maxSize / width, maxSize / height);
                    width *= ratio;
                    height *= ratio;
                    
                    // Set canvas size
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw resized image
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convert to blob
                    canvas.toBlob((blob) => {
                        if (blob) {
                            // Create new File object
                            const resizedFile = new File([blob], file.name, {
                                type: file.type,
                                lastModified: Date.now()
                            });
                            
                            console.log(`Image resized: ${img.width}x${img.height} ‚Üí ${width}x${height}`);
                            console.log(`File size: ${(file.size/1024).toFixed(1)}KB ‚Üí ${(resizedFile.size/1024).toFixed(1)}KB`);
                            
                            resolve(resizedFile);
                        } else {
                            reject(new Error('Failed to resize image'));
                        }
                    }, file.type, 0.9);
                };
                
                img.onerror = () => reject(new Error('Failed to load image'));
                img.src = URL.createObjectURL(file);
            });
        }

        function showPreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('imageDetails').innerHTML = `
                    <div class="image-detail">üìÅ <strong>„Éï„Ç°„Ç§„É´Âêç:</strong> ${file.name}</div>
                    <div class="image-detail">üìè <strong>„Çµ„Ç§„Ç∫:</strong> ${(file.size / 1024).toFixed(1)} KB</div>
                    <div class="image-detail">üñºÔ∏è <strong>ÂΩ¢Âºè:</strong> ${file.type}</div>
                `;
                
                uploadSection.classList.add('hidden');
                previewSection.classList.remove('hidden');
                previewSection.classList.add('fade-in');
                
                // Scroll to preview
                previewSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            };
            reader.readAsDataURL(file);
        }

        // Image Analysis with S3 Upload
        async function analyzeImage() {
            if (!selectedImage || !isLoggedIn) return;

            showLoading();

            try {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    const base64Data = e.target.result.split(',')[1]; // Remove data:image/jpeg;base64, prefix
                    
                    try {
                        // Get selected language and analysis type
                        const selectedLanguage = document.querySelector('input[name="language"]:checked').value;
                        const selectedType = document.querySelector('input[name="analysisType"]:checked').value;
                        const currentUser = sessionStorage.getItem('sapporoUser') || 'sapporo-guide';
                        
                        // Upload image to S3 first
                        const uploadResponse = await fetch(`${API_BASE_URL}/upload-image`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                image: base64Data,
                                filename: selectedImage.name || 'image.jpg',
                                userId: currentUser,
                                analysisType: selectedType,
                                language: selectedLanguage
                            })
                        });

                        let imageUploadResult = null;
                        if (uploadResponse.ok) {
                            imageUploadResult = await uploadResponse.json();
                            console.log('Image uploaded to S3:', imageUploadResult);
                        } else {
                            console.warn('Image upload failed, proceeding with analysis');
                        }
                        
                        // Proceed with analysis regardless of upload success
                        const response = await fetch(`${API_BASE_URL}/analyze`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                image: `data:image/jpeg;base64,${base64Data}`,
                                language: selectedLanguage,
                                type: selectedType,
                                imageId: imageUploadResult?.image_id || null,
                                s3Url: imageUploadResult?.s3_url || null
                            })
                        });

                        const responseText = await response.text();
                        showResults(response.ok, responseText, imageUploadResult);
                        
                    } catch (error) {
                        showResults(false, `„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${error.message}`);
                    }
                };
                
                reader.readAsDataURL(selectedImage);
                
            } catch (error) {
                showResults(false, `„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${error.message}`);
            }
        }

        function showLoading() {
            previewSection.classList.add('hidden');
            loadingSection.classList.remove('hidden');
            loadingSection.classList.add('fade-in');
            
            // Scroll to loading
            loadingSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function showResults(success, responseText, uploadInfo = null) {
            loadingSection.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            resultsSection.classList.add('fade-in');
            
            let content;
            if (success) {
                try {
                    const result = JSON.parse(responseText);
                    content = result.analysis || '„Éá„Éº„Çø„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
                } catch (e) {
                    content = responseText;
                }
                
                // Image is saved silently in background
            } else {
                content = `‚ùå ${responseText}`;
            }
            
            document.getElementById('resultsContent').textContent = content;
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function newAnalysis() {
            resetApp();
            // Scroll to upload
            uploadSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function resetApp() {
            selectedImage = null;
            uploadSection.classList.remove('hidden');
            previewSection.classList.add('hidden');
            loadingSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
            document.getElementById('imageInput').value = '';
        }

        // Analysis type change handler
        document.querySelectorAll('input[name="analysisType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                updateAnalysisUI(this.value);
            });
        });

        function updateAnalysisUI(type) {
            const btnText = document.getElementById('analyzeBtnText');
            const uploadText = document.querySelector('.upload-text');
            const uploadSubtext = document.querySelector('.upload-subtext');
            
            if (type === 'menu') {
                btnText.textContent = 'üìãüçú ÁúãÊùø„Éª„É°„Éã„É•„ÉºÁøªË®≥„ÇíÈñãÂßã';
                uploadText.textContent = 'ÁúãÊùø„Éª„É°„Éã„É•„Éº„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ';
                uploadSubtext.innerHTML = 'Êó•Êú¨Ë™û„ÅÆÁúãÊùø„Éª„É°„Éã„É•„Éº„ÅÆÂÜôÁúü„Çí„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó<br><strong>ÂØæÂøúÂΩ¢Âºè:</strong> JPG, PNG, GIF (ÊúÄÂ§ß 10MB)<br><strong>Áâπ„Å´ÊúâÂäπ:</strong> ÊâãÊõ∏„Åç„É°„Éã„É•„Éº„ÄÅ‰æ°Ê†ºË°®„ÄÅÊ≥®ÊñáË°®Á≠â';
            } else {
                btnText.textContent = 'ü§ñ Êú≠ÂπåË¶≥ÂÖâAIËß£Êûê„ÇíÈñãÂßã';
                uploadText.textContent = 'ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ';
                uploadSubtext.innerHTML = 'Êú≠Âπå„ÅÆÂ∫óËàó„ÉªË¶≥ÂÖâÂú∞„ÉªÊñôÁêÜ„ÅÆÂÜôÁúü„Çí„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó<br><strong>ÂØæÂøúÂΩ¢Âºè:</strong> JPG, PNG, GIF (ÊúÄÂ§ß 10MB)<br><strong>Êé®Â•®:</strong> „É©„Éº„É°„É≥„ÄÅ„Ç∏„É≥„ÇÆ„Çπ„Ç´„É≥„ÄÅÈõ™„Åæ„Å§„Çä„ÄÅ„Åô„Åô„Åç„ÅÆÁ≠â';
            }
        }

        // Auto-fill demo credentials on focus
        document.getElementById('username').addEventListener('focus', function() {
            if (!this.value) this.value = 'sapporo-guide';
        });
        
        document.getElementById('password').addEventListener('focus', function() {
            if (!this.value) this.value = 'hokkaido2024';
        });
    </script>
</body>
</html>